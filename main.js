(()=>{"use strict";class t{validate(t){this.regex=/\[?(-?[0-9]+\.[0-9]+)\s?,\s?(-?[0-9]+\.[0-9]+)\]?/gm;const e=this.regex.exec(t);if(!e)throw new Error("координаты введены не верно");const o=e[1],n=e[2];if(parseFloat(o.replace("-",""))>90||parseFloat(n.replace("-",""))>180)throw new Error("координаты за пределами допустимых значений");return{latitude:o,longitude:n}}}(new class{constructor(){this.storage=JSON.parse(window.localStorage.getItem("posts"))||[],this.storage.length&&(this.posts=this.storage.sort(((t,e)=>new Date(t.date)-new Date(e.date)))),this.container=document.createElement("div"),this.container.id="container",document.body.appendChild(this.container),this.coordsValidator=new t}drawPost(t){const e=document.createElement("div");e.className="post";const o=document.createElement("span");o.className="post-date",o.innerText=t.date;const n=document.createElement("p");n.className="post-text",n.innerText=t.text;const a=document.createElement("span");a.className="post-location",a.innerText=`${t.coords.latitude}, ${t.coords.longitude}`,e.append(o,n,a),this.addButton.insertAdjacentElement("afterend",e)}openModal(){this.manualLocation=!1;const t=document.createElement("div");t.id="modal-container";const e=document.createElement("div");e.id="modal-window";const o=document.createElement("form");o.id="add-form",o.name="add-form";const n=document.createElement("textarea");n.name="post-text",n.id="post-text",n.setAttribute("required",""),n.placeholder="Write something..";const a=document.createElement("button");a.id="save-button",a.innerText="Добавить";const s=document.createElement("button");s.id="cancel-button",s.innerText="Отмена",document.body.append(t),t.append(e),e.append(o),o.append(n,a,s),s.addEventListener("click",(t=>{t.preventDefault(),document.getElementById("modal-container").remove()})),o.addEventListener("submit",(t=>{if(t.preventDefault(),this.data={text:n.value},this.manualLocation)try{this.data.coords=this.coordsValidator.validate(this.postLocation.value),this.savePost()}catch(t){"warning"===this.postLocation.nextSibling.className&&this.postLocation.nextSibling.remove(),this.postLocation.insertAdjacentHTML("afterend",`<span class="warning">${t.message}</span>`)}else navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:o}=t.coords;this.data.coords={latitude:e,longitude:o},this.savePost()}),(()=>{this.showCoordsField(),this.manualLocation=!0}))}))}savePost(){this.data.date=(new Date).toLocaleString(),this.storage.push(this.data),window.localStorage.setItem("posts",JSON.stringify(this.storage)),this.drawPost(this.data),document.getElementById("modal-container").remove()}showAddButton(){this.addButton=document.createElement("button"),this.addButton.innerText="Добавить пост +",this.addButton.id="add-button",this.addButton.addEventListener("click",(t=>{t.preventDefault(),this.openModal()})),this.container.append(this.addButton)}showCoordsField(){this.postLocation=document.createElement("input"),this.postLocation.id="post-location",this.postLocation.name="post-location",this.postLocation.required=!0,document.getElementById("post-text").insertAdjacentHTML("afterend",'<span class="warning">Пожалуйста, введите координаты:</span>'),document.getElementById("save-button").insertAdjacentElement("beforebegin",this.postLocation)}init(){this.showAddButton(),this.posts&&this.posts.forEach((t=>t.drawPost(t)))}}).init()})();